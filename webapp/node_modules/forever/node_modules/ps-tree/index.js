var spawn = require('child_process').spawn, 
  //es    = require('event-stream')
  parseTable = require('parse-table')
  ;

module.exports = childrenOfPid
function childrenOfPid( pid, callback) {
  var headers = null

  if('function' !== typeof callback) 
    throw new Error('childrenOfPid(pid, callback) expects callback')
  if('number' == typeof pid)
    pid = pid.toString()
  
  child = spawn('ps', ['-A', '-o', 'ppid,pid,cmd'])

  child.stdout.pipe(parseTable(function (err, ps) {
      var parents = [pid], children = []
      ps.forEach(function (proc) {
        if(-1 != parents.indexOf(proc.PPID)) {
          parents.push(proc.PID)
          children.push(proc)
        }
      })
      callback(null, children)    
    }))
  child.on('error', callback)
}

if(!module.parent) {
  childrenOfPid(process.argv[2] || 1, function (err, data) {
  console.log(data)
  })
}